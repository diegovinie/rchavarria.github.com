
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Uso avanzado de SwingWorker - R. Chavarria's Blog</title>
  <meta name="author" content="Rub&eacute;n Chavarr&iacute;a">

  
  <meta name="description" content="Uso avanzado de SwingWorker Jan 26th, 2010 Este post pertenece a mi antiguo blog en wordpress, pero decidí pasarme a github:pages por las siguientes &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rchavarria.github.io/blog/2010/01/26/uso-avanzado-de-swingworker/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="R. Chavarria's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36829645-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">R. Chavarria's Blog</a></h1>
  
    <h2>Blogging like a hacker about Software Development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rchavarria.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archivos</a></li>
  <li><a href="/readings">Lista de lectura</a></li>
  <li><a href="/pet-projects">Proyectos</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Uso avanzado de SwingWorker</h1>
    <p class="meta">








  


<time datetime="2010-01-26T09:44:00+01:00" pubdate data-updated="true">Jan 26<span>th</span>, 2010</time></p>
  </header>
  
  <div style="margin:2%; padding:2%; background-color:#E0E0E0; ">
  <p>Este post pertenece a mi antiguo blog en <a href="http://rchavarria.wordpress.com">wordpress</a>, pero decidí pasarme a github:pages por las siguientes <a href="/blog/2012/12/03/por-que-cambie-mi-blog-en-wordpress-com">razones</a></p>
</div>


<p>En una entrada anterior vimos cómo hacer un <a href="/blog/2010/01/08/swingworker-en-java-5/">uso básico de SwingWorker</a> así como cuándo usarlo. Vimos que había dos métodos de recuperar el resultado de nuestros cálculos o tarea de larga duración.</p>

<p>Aquí veremos un uso avanzado de <code>SwingWorker</code>. Para ello realizaremos una sencilla aplicación que calcule los <strong>N</strong> primeros números de la serie de fibonacci, los vaya mostrando en un área de texto según los vaya calculando y mostraremos el progreso de la tarea un una barra de progreso.</p>

<!-- more -->


<p>La clase <code>SwingWorker</code> tiene la siguiente definición: <code>SwingWorker&lt;T, V&gt;</code>. En la entrada anterior vimos que la forma básica de recuperar el resultado de nuestros cálculos era a través del método <code>get()</code>, el cuál retorna un valor de tipo genérico <strong>T</strong>. El genérico <strong>V</strong> es el tipo de datos que admiten los métodos <code>publish</code> y <code>process</code> y es el tipo de datos en el que generaremos los resultados intermedios.</p>

<p>Para realizar nuestra tarea del cálculo de los números de fibonacci crearemos una clase <code>FibonacciWorker</code> que herede de <code>SwingWorker</code> y que haga uso de los métodos adecuados para notificar el progreso hecho en los cálculos. Esta notificación la haremos a través de eventos de cambios en una propiedad. Es posible utilizar <code>PropertyChangelListeners</code> con propiedades definidas por nosotros y utilizar el método <code>firePropertyChange</code> para lanzar estos eventos. Para este ejemplo utilizaremos la propiedad <code>progress</code> que es una propiedad que ya está enlazada por defecto. La propiedad <code>state</code> (indica el estado de la ejecución de la tarea: <em>INCIADA</em>, <em>CANCELADA</em>, <em>COMPLETADA</em>, &#8230;) también lo está.</p>

<figure class='code'><figcaption><span>Nuestra tarea hereda de SwingWorker </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class FibonacciWorker extends SwingWorker&lt;List&lt;Integer&gt;, Integer&gt; {
</span><span class='line'>  PrimeNumbersTask(JTextArea textArea, int numbersToCalculate) {
</span><span class='line'>    //initialize
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public List&lt;Integer&gt; doInBackground() {
</span><span class='line'>    while (numbers.size &lt;= numberstoCalculate &amp;&amp; !isCancelled()) {
</span><span class='line'>      number = nextFibonacciNumber();
</span><span class='line'>      numbers.add(number);
</span><span class='line'>      publish(number);
</span><span class='line'>      setProgress(100 * numbers.size() / numbersToCalculate);
</span><span class='line'>    }
</span><span class='line'>    return numbers;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  protected void process(List&lt;Integer&gt; chunks) {
</span><span class='line'>    for (Integer number : chunks) {
</span><span class='line'>      textArea.append(number + &quot;\n&quot;);
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  private Integer nextFibonacciNumber(){
</span><span class='line'>    //  calculate next fibonacci number and return it
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>En el código anterior se han omitido detalles de implementación para no desviar la atención. Del código anterior cabe destacar la llamada a <code>publish</code> en la línea <strong>11</strong>, la llamada a <code>setProgress</code> (línea <strong>12</strong>) y la implementación del método <code>process</code>.</p>

<p>Mediante la llamada al método <code>publish</code> indicamos a <code>SwingWorker</code> que vaya almacenando resultados intermedios con los cuales llamará al método <code>process</code>, el cual hemos sobrescrito y lo usaremos para mostrar esos resultados intermedios. Es muy importante recalcar que mientras el método <code>publish</code> se ejecuta en el hilo (thread) del cálculo exhaustivo, el método <code>process</code> se invoca en el <strong>Event Dispatching Thread (EDT)</strong>, y es por ello por lo que es seguro actualizar el interfaz de usuario.</p>

<p>Con la llamada al método <code>setProgress()</code> estamos indicando que se lance un evento de cambio sobre la propiedad <code>progress</code> (propiedad creada por defecto junto con <code>state</code> para la notificación de cambios en propiedades). El evento propagado incluirá entre sus datos el parámetro que recibe la función. Para mostrar ese progreso utilizaremos una barra de progreso, la cual la registraremos como interesada en recibir eventos de cambios en las propiedades de <code>FibonacciWorker</code>.</p>

<figure class='code'><figcaption><span>Actualizar una barra de progreso </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>final JProgressBar progressBar = new JProgressBar(0, 100);
</span><span class='line'>FibonacciWorker task = new FibonacciWorker(textArea, numbersToCalculate);
</span><span class='line'>task.addPropertyChangeListener(
</span><span class='line'>  new PropertyChangeListener() {
</span><span class='line'>    public  void propertyChange(PropertyChangeEvent evt) {
</span><span class='line'>      if ("progress".equals(evt.getPropertyName())) {
</span><span class='line'>        progressBar.setValue((Integer)evt.getNewValue());
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  });</span></code></pre></td></tr></table></div></figure>


<p>En el siguiente enlace es posible ver una aplicación demostrando lo aprendido. Si se desea descargar el código fuente en forma de proyecto de NetBeans: <a href="http://kenai.com/projects/rchavarria/downloads/download/fibonacci%252FFibonacciCalculator%2520NB%2520project.zip"><strong>FibonacciWorker NetBeans project</strong></a>.</p>

<p><a href="http://kenai.com/projects/rchavarria/downloads/download/fibonacci%252Flaunch.jnlp"><img class="center" title="Ejecutar FibonacciCalculator" src="/images/wordpress/launch.png" alt="" width="88" height="23" /></a></p>

<div id="_mcePaste" style="overflow:hidden;position:absolute;left:-10000px;top:285px;width:1px;height:1px;">http://rchavarria.wordpress.com/2010/01/08/swingworker-en-java-5/</div>


  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/18/mi-primer-code-retreat/">Mi primer Code Retreat</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/02/mi-primer-katayuno/">Mi primer katayuno</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/23/screencast-programacion-juego-disparejo/">Screencast de programacion: el Juego del disparejo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/17/jenkins-ci-inyectar-variable-de-entorno/">Jenkins CI: inyectar variable de entorno</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/11/aprendiendo-vim/">Aprendiendo Vim</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rchavarriat", 4, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <p>Follow <a href="http://twitter.com/rchavarriat">@rchavarriat</a></p>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/rchavarriat?count=5&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/rchavarriat">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Rub&eacute;n Chavarr&iacute;a -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rchavarria-github-com';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rchavarria.github.io/blog/2010/01/26/uso-avanzado-de-swingworker/';
        var disqus_url = 'http://rchavarria.github.io/blog/2010/01/26/uso-avanzado-de-swingworker/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
