
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Formatear y parsear enumerados en Java con valores personalizados - R. Chavarria's Blog</title>
  <meta name="author" content="Rub&eacute;n Chavarr&iacute;a">

  
  <meta name="description" content="Formatear y parsear enumerados en Java con valores personalizados Jan 22nd, 2013 A partir de la versión 1.5 de Java, nos encontramos con un tipo de &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rchavarria.github.io/blog/2013/01/22/formatear-y-parsear-enumerados-en-java-con-valores-personalizados/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="R. Chavarria's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36829645-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">R. Chavarria's Blog</a></h1>
  
    <h2>Proud of developing software, proud of being an Engineer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rchavarria.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archivos</a></li>
  <li><a href="/readings">Lista de lectura</a></li>
  <li><a href="/pet-projects">Proyectos</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Formatear y parsear enumerados en Java con valores personalizados</h1>
    <p class="meta">








  


<time datetime="2013-01-22T13:17:00+01:00" pubdate data-updated="true">Jan 22<span>nd</span>, 2013</time></p>
  </header>
  
  <p>A partir de la versión 1.5 de Java, nos encontramos con un tipo de datos, un tipo
especial de clases podríamos decir, los enumerados. Los tipos enumerados sirven para
acotar los posibles valores que puede tomar una variable o tipo de objeto. Java
proporciona un método para transformar un enumerado en cadena, <code>name()</code>, y un método
estático para convertir una cadena en uno de los valores del enumerado,
<code>valueOf(String)</code>. Pero estos métodos son un poco limitados, ya que no nos permiten
personalizar los valores a los cuales son transformados los enumerados.</p>

<!-- more -->


<p>Partiremos del siguiente código describiendo tres valores en un enumerado:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">enum</span> <span class="n">States</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">EVERYTHING_IS_OK</span><span class="o">,</span>
</span><span class='line'>  <span class="n">SOMETHING_WENT_WRONG</span><span class="o">,</span>
</span><span class='line'>  <span class="n">TOTAL_FAILURE</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Así, sin más, podemos obtener la representación en <code>String</code> de <code>States.TOTAL_FAILURE</code>
simplemente llamando al método <code>States.TOTAL_FAILURE.name()</code>. De la misma forma, usando
la llamada <code>States.valueOf("EVERYTHING_IS_OK")</code> es fácil imaginar qué valor del enumerado
obtendremos.</p>

<p>Pero, y si en lugar de esa representación a <code>String</code>, ¿queremos definir la nuestra
propia?. Por ejemplo, siguiendo la siguiente tabla:</p>

<ul>
<li>EVERYTHING_IS_OK &rarr; green</li>
<li>SOMETHING_WENT_WRONG &rarr; yellow</li>
<li>TOTAL_FAILURE &rarr; red</li>
</ul>


<h2>Formatear a cadena</h2>

<p>Formatear es sencillo, y directo. Podemos declarar un campo <code>value</code> donde almacenar el
valor al cual queremos transformar el enumerado, y podemos sobreescribir el método
<code>toString()</code> de la siguiente manera:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">enum</span> <span class="n">States</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">EVERYTHING_IS_OK</span><span class="o">(</span><span class="s">&quot;green&quot;</span><span class="o">),</span>
</span><span class='line'>  <span class="n">SOMETHING_WENT_WRONG</span><span class="o">(</span><span class="s">&quot;yellow&quot;</span><span class="o">),</span>
</span><span class='line'>  <span class="n">TOTAL_FAILURE</span><span class="o">(</span><span class="s">&quot;red&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="nf">States</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Parsear desde una cadena</h2>

<p>El problema viene cuando queremos obtener un valor del enumerado a partir de un <code>String</code>.
Supongamos que la transformación la vamos a hacer en un método estático, que por contraste
con el anterior método llamaremos <code>fromString</code>. Veamos qué opciones tenemos, de menos a
más apropiadas:</p>

<h3>Sentencias if</h3>

<p>La primera solución que le viene a uno a la cabeza es usar sentencias <code>if</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">[...]</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">States</span> <span class="nf">fromString</span><span class="o">(</span><span class="n">String</span> <span class="n">fromValue</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span><span class="o">(</span><span class="s">&quot;green&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fromValue</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">EVERYTHING_IS_OK</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="s">&quot;yellow&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fromValue</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">SOMETHING_WENT_WRONG</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="s">&quot;red&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fromValue</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">TOTAL_FAILURE</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;Wrong value: &quot;</span> <span class="o">+</span> <span class="n">fromValue</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">[...]</span>
</span></code></pre></td></tr></table></div></figure>


<p>No hay mucho que decir aquí, simplemente que se debería evitar a toda costa esta solución.</p>

<h3>Bucle for</h3>

<p>Otra solución, un poco más elegante, pero básicamente siguiendo la misma filosofía, podría
ser utilizar un bucle para recorrer los posibles valores del enumerado:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">[...]</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">States</span> <span class="nf">fromString</span><span class="o">(</span><span class="n">String</span> <span class="n">fromValue</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">for</span><span class="o">(</span><span class="n">States</span> <span class="n">state</span> <span class="o">:</span> <span class="n">values</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fromValue</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">state</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;Wrong value: &quot;</span> <span class="o">+</span> <span class="n">fromValue</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">[...]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esta solución es un poquito mejor, ya que si modificamos los valores posibles del enumerado,
no es necesario que modifiquemos este método.</p>

<h3>Prealmacenamiento de los valores en un Map</h3>

<p>Existe una solución que no involucra el uso de sentencias <code>if</code>, lo cual es muy positivo, ya
que estamos evitando la posibilidad de error, ya que no tendremos que formular una condición.</p>

<p>Esta solución la encontré en un hilo el de Stack Overflow <a href="http://stackoverflow.com/questions/1080904/how-can-i-lookup-a-java-enum-from-its-string-value">how can I lookup a Java enum
from its string value?</a>.
Lo que pretende esta solución es crear una estructura de datos, y cuando se quiera transformar
un <code>String</code> en un valor del enumerado, simplemente se consulte esa estructura de datos.</p>

<p>La estructura de datos será un <code>Map</code> estático, que se rellenará en un bloque estático y
consultaremos en nuestro método <code>fromString</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">[...]</span>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">States</span><span class="o">&gt;</span> <span class="n">dictionary</span><span class="o">;</span>
</span><span class='line'><span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">dictionary</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">States</span><span class="o">&gt;();</span>
</span><span class='line'>  <span class="k">for</span><span class="o">(</span><span class="n">States</span> <span class="n">state</span> <span class="o">:</span> <span class="n">values</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">dictionary</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">value</span><span class="o">;</span> <span class="n">state</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">[...]</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">States</span> <span class="nf">fromString</span><span class="o">(</span><span class="n">String</span> <span class="n">fromValue</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">States</span> <span class="n">state</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fromValue</span><span class="o">);</span>
</span><span class='line'>  <span class="k">if</span><span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;Wrong value: &quot;</span> <span class="o">+</span> <span class="n">fromValue</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">state</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">[...]</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Peligros de esta última solución</h2>

<p>En Stack Overflow, un comentario a la respuesta donde encontré la solución sugiere que esta solución
puede causar problemas debido al classloader.</p>

<p>Pero he investigado un poco el tema, y parece que el comentario es erróneo, al menos para el
uso de los enumerados que estoy exponiendo aquí. Según el
<a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-8.html#d5e12253">ejemplo 8.9.2-1 de la especificación del java</a>,
primero se inicializan los valores del enumerado, luego la variable estática y finalmente
se ejecuta el bloque de código estático, estando ya todos los valores del enumerado
inicializados.</p>

<p>Aquí os dejo unos cuantos enlaces a que confirman que la última solución es correcta:</p>

<ul>
<li><a href="http://blog.deepincode.com/2006/12/bootstrapping-static-fields-within-enums">Bootstrapping static fields within enums</a> y en enlace encontrado en ese mismo post: <a href="http://blog.deepincode.com/2006/11/type-safe-enumerations-in-java-50">Type Safe Enumerations in Java 5.0</a> (buscar al final de este último post).</li>
<li>Otro hilo de Stack Overflow, <a href="http://stackoverflow.com/questions/6827987/when-are-these-class-and-subclass-static-blocks-executed-for-an-enum">When are these class and subclass static blocks executed (for an Enum)?</a> que me lleva al recurso definitivo:</li>
<li><a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-8.html#d5e12253">Java Language Specification - Example 8.9.2-1</a>: Si la documentación de Oracle sobre java es errónea, apaga y vámonos.</li>
</ul>


<h2>Otras soluciones</h2>

<p>Por supuesto que existen otras soluciones, quizá mejores que la última que propongo, pero
no he querido hacer más largo este post y he querido centrarme en proponer una alternativa
a los métodos <code>.name()</code> y <code>.valueOf()</code>, pertenecientes al propio enumerado.</p>

<p>Es por esto por lo que he descartado usar clases externas para formatear o parsear el
enumerado, lo cual me habría hecho llegar a otras soluciones bien distintas. Pero si crees
que tu solución es muchísimo mejor que ésta, déjame un comentario, será bienvenido.</p>

  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/27/elixir-segundo-asalto/">Elixir: segundo asalto</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/15/the-software-craftsman/">The Software Craftsman</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/09/elixir-primer-asalto/">Elixir: primer asalto</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/31/codigo-no-suficientemente-grande-para-dos/">El código fuente no es suficientemente grande para los dos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/17/aprendiendo-elixir/">Aprendiendo Elixir</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rchavarriat", 4, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <p>Follow <a href="http://twitter.com/rchavarriat">@rchavarriat</a></p>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/rchavarriat?count=5&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/rchavarriat">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Rub&eacute;n Chavarr&iacute;a -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rchavarria-github-com';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rchavarria.github.io/blog/2013/01/22/formatear-y-parsear-enumerados-en-java-con-valores-personalizados/';
        var disqus_url = 'http://rchavarria.github.io/blog/2013/01/22/formatear-y-parsear-enumerados-en-java-con-valores-personalizados/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
